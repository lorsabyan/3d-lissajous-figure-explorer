var R=Object.defineProperty;var G=(a,e,t)=>e in a?R(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var A=(a,e,t)=>G(a,typeof e!="symbol"?e+"":e,t);import{S as f,C as m,V as h,G as U,W as w,P as D,O as E,E as O,R as j,U as V,a as H,b as N,c as F,d as T,e as _,f as Y,g as q,M as S,L as z,h as P,T as y,i as X,B as $,j as Z,k as K,l as W}from"./three-CGPAIrlP.js";import{g as J,i as M}from"./ui-6IQGdPFV.js";import{k as Q}from"./math-D0MXDLmA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const d={CURVE_POINTS:2e3,PROJECTION_UPDATE_INTERVAL:2,GEOMETRY_CACHE_LIMIT:10,DEBOUNCE_CURVE_UPDATE:16,DEBOUNCE_GRID_UPDATE:100,THROTTLE_AUDIO_UPDATE:50,DEBOUNCE_RESIZE:100},ee={a:1,b:2,c:3,A:1,B:1,C:1,deltaX:Math.PI/2,deltaY:0,deltaZ:0,damping:0,lineThickness:.015,gridThickness:.01,gridBrightness:1.7,color:{h:120,s:1,l:.5},glow:.5,aa:!0,isPhaseAnimating:!1,isAudioEnabled:!1},C={perspective:{x:2,y:3,z:5},top:{x:0,y:6,z:.01},front:{x:0,y:0,z:6},side:{x:6,y:0,z:0}},u=(a,e,t)=>Math.max(e,Math.min(t,a)),x=(a,e)=>{let t;return function(...n){const s=()=>{clearTimeout(t),a(...n)};clearTimeout(t),t=setTimeout(s,e)}},L=(a,e)=>{let t;return function(){const i=arguments,n=this;t||(a.apply(n,i),t=!0,setTimeout(()=>t=!1,e))}},te=a=>(a.a=u(a.a,1,10),a.b=u(a.b,1,10),a.c=u(a.c,0,10),a.A=u(a.A,.1,2),a.B=u(a.B,.1,2),a.C=u(a.C,.1,2),a.damping=u(a.damping,0,.5),a),ie=a=>`${a.a}-${a.b}-${a.c}-${a.A}-${a.B}-${a.C}-${a.deltaX.toFixed(3)}-${a.deltaY.toFixed(3)}-${a.deltaZ.toFixed(3)}-${a.damping.toFixed(3)}`,ne=(a,e)=>{const t=JSON.stringify(a),i=JSON.stringify(e);return t!==i};class k extends EventTarget{constructor(e,t,i){super(),this.container=e,this.options=i,this.isDragging=!1,this.value=i.initial,this.angle=this.valueToAngle(this.value),this.createDOM(t,i.isSwitch),this.addEventListeners(),this.updateVisuals()}createDOM(e,t=!1){const n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg");s.setAttribute("class","knob"),s.setAttribute("width",80),s.setAttribute("height",80),s.setAttribute("viewBox","0 0 80 80");const o=document.createElementNS(n,"circle");o.setAttribute("cx",80/2),o.setAttribute("cy",80/2),o.setAttribute("r",80/2*.9),o.setAttribute("fill","#1f2937"),o.setAttribute("stroke","#4b5563"),o.setAttribute("stroke-width","2"),s.appendChild(o);const l=document.createElementNS(n,"circle");l.setAttribute("r",4),l.setAttribute("fill","#4ade80"),this.indicator=l,s.appendChild(l);const r=document.createElementNS(n,"text");r.setAttribute("x","50%"),r.setAttribute("y","50%"),r.setAttribute("dy","0.3em"),r.setAttribute("text-anchor","middle"),r.setAttribute("font-family","Roboto Mono, monospace"),r.setAttribute("font-size",t?"24":"14"),r.setAttribute("font-weight","bold"),r.setAttribute("fill","#f3f4f6"),this.text=r,s.appendChild(r);const c=document.createElement("div");c.textContent=e,c.className="text-sm mt-1",this.container.appendChild(s),this.container.appendChild(c)}addEventListeners(){this.mouseDownHandler=e=>this.startDrag(e),this.mouseMoveHandler=e=>this.drag(e),this.mouseUpHandler=e=>this.endDrag(e),this.touchStartHandler=e=>this.startDrag(e),this.touchMoveHandler=e=>this.drag(e),this.touchEndHandler=e=>this.endDrag(e),this.container.addEventListener("mousedown",this.mouseDownHandler),window.addEventListener("mousemove",this.mouseMoveHandler),window.addEventListener("mouseup",this.mouseUpHandler),this.container.addEventListener("touchstart",this.touchStartHandler,{passive:!1}),window.addEventListener("touchmove",this.touchMoveHandler,{passive:!1}),window.addEventListener("touchend",this.touchEndHandler)}cleanup(){this.container&&(this.container.removeEventListener("mousedown",this.mouseDownHandler),this.container.removeEventListener("touchstart",this.touchStartHandler)),window.removeEventListener("mousemove",this.mouseMoveHandler),window.removeEventListener("mouseup",this.mouseUpHandler),window.removeEventListener("touchmove",this.touchMoveHandler),window.removeEventListener("touchend",this.touchEndHandler)}startDrag(e){e.preventDefault(),this.isDragging=!0,this.container.style.cursor="grabbing"}endDrag(){this.isDragging=!1,this.container.style.cursor="pointer"}setValue(e){this.isDragging||(this.value=Math.max(this.options.min,Math.min(this.options.max,e)),this.angle=this.valueToAngle(this.value),this.updateVisuals())}updateVisuals(){this.indicator.setAttribute("cx",80/2+28*Math.sin(this.angle)),this.indicator.setAttribute("cy",80/2-28*Math.cos(this.angle)),this.text&&(this.text.textContent=this.value.toFixed(this.options.precision||0))}}class se extends k{constructor(e,t,i){super(e,t,{...i,isSwitch:!0,precision:0})}drag(e){if(!this.isDragging)return;e.preventDefault();const t=this.container.getBoundingClientRect(),i=t.left+t.width/2,n=t.top+t.height/2,s=e.clientX||e.touches[0].clientX,o=e.clientY||e.touches[0].clientY,l=(Math.atan2(o-n,s-i)+Math.PI/2+2*Math.PI)%(2*Math.PI),r=this.options.max-this.options.min+1,c=2*Math.PI/r;let p=Math.round(l/c);p=p%r;const g=this.options.min+p;g!==this.value&&(this.value=g,this.angle=this.valueToAngle(this.value),this.updateVisuals(),this.dispatchEvent(new CustomEvent("change",{detail:{value:this.value}})))}valueToAngle(e){const t=this.options.max-this.options.min+1,i=2*Math.PI/t;return(e-this.options.min)*i}}class v extends k{constructor(e,t,i){super(e,t,{...i,isSwitch:!1})}drag(e){if(!this.isDragging)return;e.preventDefault();const t=this.container.getBoundingClientRect(),i=t.left+t.width/2,n=t.top+t.height/2,s=e.clientX||e.touches[0].clientX,o=e.clientY||e.touches[0].clientY,l=s-i,r=o-n;this.angle=(Math.atan2(r,l)+Math.PI/2+2*Math.PI)%(2*Math.PI),this.value=this.angleToValue(this.angle),this.updateVisuals(),this.dispatchEvent(new CustomEvent("change",{detail:{value:this.value}}))}updateVisuals(){super.updateVisuals(),this.options.isPhase&&(this.text.textContent=`${this.value.toFixed(2)}π`)}angleToValue(e){return e/(2*Math.PI)*(this.options.max-this.options.min)+this.options.min}valueToAngle(e){return(e-this.options.min)/(this.options.max-this.options.min)*2*Math.PI}}class ae{constructor(){this.audioContext=null,this.masterGain=null,this.oscillators={},this.initialized=!1}async init(){if(!this.initialized)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.masterGain=this.audioContext.createGain(),this.masterGain.gain.value=0,this.masterGain.connect(this.audioContext.destination),["a","b","c"].forEach(e=>{const t=this.audioContext.createOscillator(),i=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(110,this.audioContext.currentTime),t.connect(i),i.connect(this.masterGain),i.gain.setValueAtTime(0,this.audioContext.currentTime),t.start(),this.oscillators[e]={osc:t,gainNode:i}}),this.initialized=!0,console.log("Audio system initialized successfully")}catch(e){console.warn("Audio initialization failed:",e),this.initialized=!1}}updateParams(e){if(!(!this.initialized||!this.audioContext))try{const i=this.audioContext.currentTime+.01;this.oscillators.a.osc.frequency.linearRampToValueAtTime(110*e.a,i),this.oscillators.b.osc.frequency.linearRampToValueAtTime(110*e.b,i),e.c>0&&this.oscillators.c.osc.frequency.linearRampToValueAtTime(110*e.c,i),this.oscillators.a.gainNode.gain.linearRampToValueAtTime(e.A*.08,i),this.oscillators.b.gainNode.gain.linearRampToValueAtTime(e.B*.08,i),this.oscillators.c.gainNode.gain.linearRampToValueAtTime(e.c>0?e.C*.08:0,i)}catch(t){console.warn("Audio update failed:",t)}}setVolume(e){this.masterGain&&this.audioContext&&this.masterGain.gain.linearRampToValueAtTime(e,this.audioContext.currentTime+.1)}cleanup(){try{this.audioContext&&this.audioContext.state!=="closed"&&this.audioContext.close()}catch(e){console.warn("Audio cleanup error:",e)}}}class oe{constructor(){this.mainScene=new f,this.projectionScenes={xy:new f,xz:new f,yz:new f},this.geometryCache=new Map,this.gridMaterialCache=new Map,this.lastUpdateParams={},this.initializeScenes(),this.initialized=!1}initialize(){this.initialized||(this.initializeRenderers(),this.initializeCameras(),this.initializePostProcessing(),this.initializeControls(),this.initializeGrid(),this.initialized=!0)}initializeScenes(){this.mainScene.background=new m("#0a0a0a"),this.mainScene.add(this.createAxisLabel("X","#ff7b7b",new h(2.5,0,0)),this.createAxisLabel("Y","#7bff7b",new h(0,2.5,0)),this.createAxisLabel("Z","#7b7bff",new h(0,0,2.5)));const e=new m(2258722);for(const[t,i]of Object.entries(this.projectionScenes)){i.background=new m("#0a0a0a");const n=new U(4,8,e,e);t==="xy"?n.rotation.x=Math.PI/2:t==="yz"&&(n.rotation.z=Math.PI/2),i.add(n)}}initializeRenderers(){const e=document.querySelector("#webgl"),t=document.querySelector("#canvas-xy"),i=document.querySelector("#canvas-xz"),n=document.querySelector("#canvas-yz");if(!e||!t||!i||!n)throw new Error("Required canvas elements not found in DOM");this.mainRenderer=new w({canvas:e,antialias:!1,powerPreference:"high-performance",alpha:!1}),this.mainRenderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.mainRenderer.setSize(window.innerWidth,window.innerHeight),this.mainRenderer.shadowMap.enabled=!1,this.projectionRenderers={xy:new w({canvas:t,antialias:!0,alpha:!1,powerPreference:"default"}),xz:new w({canvas:i,antialias:!0,alpha:!1,powerPreference:"default"}),yz:new w({canvas:n,antialias:!0,alpha:!1,powerPreference:"default"})},Object.values(this.projectionRenderers).forEach(s=>{s.setPixelRatio(Math.min(window.devicePixelRatio,1.5))})}initializeCameras(){this.mainCamera=new D(75,window.innerWidth/window.innerHeight,.1,1e3),this.mainCamera.position.set(2,3,5),this.projectionCameras={xy:new E(-2.2,2.2,2.2,-2.2,.1,1e3),xz:new E(-2.2,2.2,2.2,-2.2,.1,1e3),yz:new E(-2.2,2.2,2.2,-2.2,.1,1e3)},this.projectionCameras.xy.position.set(0,0,10),this.projectionCameras.xz.position.set(0,10,0),this.projectionCameras.xz.lookAt(0,0,0),this.projectionCameras.yz.position.set(10,0,0),this.projectionCameras.yz.lookAt(0,0,0)}initializePostProcessing(){this.composer=new O(this.mainRenderer),this.renderPass=new j(this.mainScene,this.mainCamera),this.bloomPass=new V(new H(window.innerWidth,window.innerHeight),.5,.3,0),this.smaaPass=new N(window.innerWidth*this.mainRenderer.getPixelRatio(),window.innerHeight*this.mainRenderer.getPixelRatio()),this.composer.addPass(this.renderPass),this.composer.addPass(this.bloomPass),this.composer.addPass(this.smaaPass)}initializeControls(){this.controls=new F(this.mainCamera,this.mainRenderer.domElement),this.controls.enableDamping=!0,this.controls.autoRotate=!0,this.controls.autoRotateSpeed=.5}initializeGrid(){this.gridGroup=new T,this.mainScene.add(this.gridGroup)}createAxisLabel(e,t,i){const n=document.createElement("canvas"),s=n.getContext("2d"),o=128;n.width=o,n.height=o,s.font=`bold ${o*.8}px 'Roboto Mono', monospace`,s.fillStyle=t,s.textAlign="center",s.textBaseline="middle",s.fillText(e,o/2,o/2);const l=new _(n),r=new Y({map:l,transparent:!0,sizeAttenuation:!1}),c=new q(r);return c.position.copy(i),c.scale.set(.1,.1,1),c}getGridMaterial(e){const t=e.toFixed(2);return this.gridMaterialCache.has(t)||this.gridMaterialCache.set(t,new S({color:"#000000",emissive:new m(1723674),emissiveIntensity:e})),this.gridMaterialCache.get(t)}createGlowingGridPlane(e,t,i,n){const s=new T,o=e/t,l=e/2;for(let r=0;r<=t;r++){const c=-l+r*o,p=new z(new h(c,-l,0),new h(c,l,0));s.add(new P(new y(p,1,n,4),i));const g=new z(new h(-l,c,0),new h(l,c,0));s.add(new P(new y(g,1,n,4),i))}return s}updateGrid(e){for(;this.gridGroup.children.length>0;){const o=this.gridGroup.children[0];this.gridGroup.remove(o),o.children&&o.children.forEach(l=>{l.geometry&&l.geometry.dispose(),l.material&&!this.gridMaterialCache.has(l.material)&&l.material.dispose()})}const t=this.getGridMaterial(e.gridBrightness),i=this.createGlowingGridPlane(4,8,t,e.gridThickness),n=this.createGlowingGridPlane(4,8,t,e.gridThickness);n.rotation.x=Math.PI/2;const s=this.createGlowingGridPlane(4,8,t,e.gridThickness);s.rotation.y=Math.PI/2,this.gridGroup.add(i,n,s)}needsCurveUpdate(e){const t={a:e.a,b:e.b,c:e.c,A:e.A,B:e.B,C:e.C,deltaX:e.deltaX,deltaY:e.deltaY,deltaZ:e.deltaZ,damping:e.damping,lineThickness:e.lineThickness,color:`${e.color.h}-${e.color.s}-${e.color.l}`};return ne(t,this.lastUpdateParams)?(this.lastUpdateParams=t,!0):!1}updateCurve(e){if(!this.needsCurveUpdate(e))return;if(te(e),this.mainCurve&&(this.mainScene.remove(this.mainCurve),this.mainCurve.geometry.dispose()),this.mainMaterial&&this.mainMaterial.dispose(),this.projectionMaterial&&this.projectionMaterial.dispose(),this.projectionLines)for(const[r,c]of Object.entries(this.projectionLines))this.projectionScenes[r].remove(c),c.geometry.dispose();const t=new m;t.setHSL(e.color.h/360,e.color.s,e.color.l),this.mainMaterial=new S({color:"#000000",emissive:t,emissiveIntensity:1.5}),this.projectionMaterial=new X({color:t});const i=ie(e);let n;this.geometryCache.has(i)&&this.geometryCache.size<d.GEOMETRY_CACHE_LIMIT?n=this.geometryCache.get(i):(n=this.generateCurvePoints(e),this.geometryCache.size<d.GEOMETRY_CACHE_LIMIT&&this.geometryCache.set(i,n));const s=new $().setFromPoints(n),o=new Z(n),l=new y(o,d.CURVE_POINTS/4,e.lineThickness,8,!1);this.mainCurve=new P(l,this.mainMaterial),this.mainScene.add(this.mainCurve),this.projectionLines={};for(const[r,c]of Object.entries(this.projectionScenes))this.projectionLines[r]=new K(s.clone(),this.projectionMaterial),c.add(this.projectionLines[r])}generateCurvePoints(e){const t=[];for(let i=0;i<=d.CURVE_POINTS;i++){const n=i/d.CURVE_POINTS,s=n*20*Math.PI,o=Math.exp(-e.damping*n*5),l=e.A*o*Math.sin(e.a*s/10+e.deltaX),r=e.B*o*Math.sin(e.b*s/10+e.deltaY),c=e.c===0?0:e.C*o*Math.sin(e.c*s/10+e.deltaZ);t.push(new h(l,r,c))}return t}setCameraPosition(e,t=new h(0,0,0)){typeof window.gsap<"u"?(window.gsap.to(this.mainCamera.position,{duration:1.2,ease:"power2.inOut",...e,onUpdate:()=>this.mainCamera.updateProjectionMatrix()}),window.gsap.to(this.controls.target,{duration:1.2,ease:"power2.inOut",...t,onUpdate:()=>this.controls.update()})):(this.mainCamera.position.set(e.x,e.y,e.z),this.controls.target.set(t.x,t.y,t.z),this.controls.update())}handleResize(){const e=window.innerWidth,t=window.innerHeight;this.mainCamera.aspect=e/t,this.mainCamera.updateProjectionMatrix(),this.mainRenderer.setSize(e,t),this.composer.setSize(e,t),this.bloomPass.resolution.set(e,t)}updateBloomStrength(e){this.bloomPass.strength=Math.cbrt(e)}setAntiAliasing(e){this.smaaPass.enabled=e}render(){this.controls.update(),this.composer.render()}renderProjections(){for(const[e,t]of Object.entries(this.projectionRenderers))t.render(this.projectionScenes[e],this.projectionCameras[e])}cleanup(){try{if(this.mainCurve&&(this.mainCurve.geometry.dispose(),this.mainMaterial.dispose()),this.projectionLines)for(const e of Object.values(this.projectionLines))e.geometry.dispose();this.projectionMaterial&&this.projectionMaterial.dispose(),this.geometryCache.clear(),this.gridMaterialCache.forEach(e=>e.dispose()),this.gridMaterialCache.clear(),console.log("Scene cleanup completed")}catch(e){console.warn("Scene cleanup error:",e)}}}class re{constructor(){this.stats={frameCount:0,lastFPSUpdate:performance.now(),fps:0,lastFrameTime:0},this.targetFrameTime=1e3/60}shouldRender(e=0){return e-this.stats.lastFrameTime<this.targetFrameTime?!1:(this.stats.lastFrameTime=e,!0)}update(){this.stats.frameCount++;const e=performance.now();e-this.stats.lastFPSUpdate>=1e3&&(this.stats.fps=Math.round(this.stats.frameCount*1e3/(e-this.stats.lastFPSUpdate)),this.stats.frameCount=0,this.stats.lastFPSUpdate=e,window.location.search.includes("debug")&&console.log(`FPS: ${this.stats.fps}`))}getFPS(){return this.stats.fps}}class le{constructor(){A(this,"animate",(e=0)=>{requestAnimationFrame(this.animate),this.performanceMonitor.shouldRender(e)&&(this.performanceMonitor.update(),this.frameCount++,this.params.isPhaseAnimating&&this.updatePhaseAnimation(),this.sceneManager.render(),this.frameCount%d.PROJECTION_UPDATE_INTERVAL===0&&this.sceneManager.renderProjections())});this.params={...ee},this.knobs={},this.switches={},this.frameCount=0,this.audioSystem=new ae,this.sceneManager=new oe,this.performanceMonitor=new re,this.clock=new W,window.gsap=J,this.init()}async init(){try{this.sceneManager.initialize(),this.initializeUI(),this.setupEventListeners(),this.setupMathRendering(),this.startAnimationLoop(),console.log("3D Lissajous Figure Explorer initialized successfully")}catch(e){console.error("Failed to initialize application:",e),this.fallbackInit()}}fallbackInit(){try{this.sceneManager.initialize(),this.sceneManager.updateCurve(this.params),this.startAnimationLoop()}catch(e){console.error("Critical initialization failure:",e)}}initializeUI(){this.initializeKnobs(),this.initializeColorPicker(),this.initializeSliders(),this.initializeToggles(),this.initializeCameraControls(),this.initializePanelControls()}initializeKnobs(){this.cleanupKnobs();const e=document.getElementById("frequency-knobs"),t=document.getElementById("amplitude-knobs");e.innerHTML="",t.innerHTML="",["a","b","c"].forEach(i=>{const n=document.createElement("div");n.className="knob-wrapper",e.appendChild(n),this.switches[i]=new se(n,i,{min:i==="c"?0:1,max:10,initial:this.params[i]}),this.switches[i].addEventListener("change",s=>{this.params[i]=s.detail.value,this.debouncedUpdateCurve(),this.throttledUpdateAudio()})}),["A","B","C"].forEach(i=>{const n=document.createElement("div");n.className="knob-wrapper",t.appendChild(n),this.knobs[i]=new v(n,i,{initial:this.params[i],min:.1,max:2,precision:1}),this.knobs[i].addEventListener("change",s=>{this.params[i]=s.detail.value,this.debouncedUpdateCurve(),this.throttledUpdateAudio()})}),document.getElementById("knob-deltaX-container").innerHTML="",document.getElementById("knob-deltaY-container").innerHTML="",document.getElementById("knob-deltaZ-container").innerHTML="",this.knobs.deltaX=new v(document.getElementById("knob-deltaX-container"),"δx",{initial:this.params.deltaX/Math.PI,min:0,max:2,isPhase:!0}),this.knobs.deltaY=new v(document.getElementById("knob-deltaY-container"),"δy",{initial:this.params.deltaY/Math.PI,min:0,max:2,isPhase:!0}),this.knobs.deltaZ=new v(document.getElementById("knob-deltaZ-container"),"δz",{initial:this.params.deltaZ/Math.PI,min:0,max:2,isPhase:!0});for(const i of["deltaX","deltaY","deltaZ"])this.knobs[i].addEventListener("change",n=>{this.params[i]=n.detail.value*Math.PI,this.debouncedUpdateCurve()})}cleanupKnobs(){for(const e in this.knobs)this.knobs[e]&&typeof this.knobs[e].cleanup=="function"&&this.knobs[e].cleanup();for(const e in this.switches)this.switches[e]&&typeof this.switches[e].cleanup=="function"&&this.switches[e].cleanup();this.knobs={},this.switches={}}initializeColorPicker(){const e=document.getElementById("color-picker-wrapper");e.innerHTML='<div id="color-picker"></div>',this.colorPicker=new M.ColorPicker("#color-picker",{width:280,color:{h:this.params.color.h,s:this.params.color.s*100,l:this.params.color.l*100},borderWidth:1,borderColor:"#fff",layout:[{component:M.ui.Wheel},{component:M.ui.Slider,options:{sliderType:"value"}}]}),this.colorPicker.on("color:change",t=>{const{h:i,s:n,l:s}=t.hsl;this.params.color={h:i,s:n/100,l:s/100},this.debouncedUpdateCurve()})}initializeSliders(){["damping","lineThickness","gridThickness","gridBrightness","glow"].forEach(t=>{document.getElementById(t).addEventListener("input",i=>{const n=parseFloat(i.target.value);this.params[t]=n,(t==="damping"||t==="lineThickness")&&this.debouncedUpdateCurve(),t==="gridThickness"&&this.updateGridThickness(n),t==="gridBrightness"&&this.updateGridBrightness(n),t==="glow"&&this.sceneManager.updateBloomStrength(n)})})}initializeToggles(){[{id:"toggle-aa",param:"aa",handler:t=>this.sceneManager.setAntiAliasing(t)},{id:"toggle-phase",param:"isPhaseAnimating"},{id:"toggle-audio",param:"isAudioEnabled",handler:this.handleAudioToggle.bind(this)}].forEach(({id:t,param:i,handler:n})=>{document.getElementById(t).addEventListener("change",s=>{this.params[i]=s.target.checked,n&&n(s.target.checked)})})}initializeCameraControls(){const e={"preset-persp":C.perspective,"preset-top":C.top,"preset-front":C.front,"preset-side":C.side};for(const[t,i]of Object.entries(e))document.getElementById(t).addEventListener("click",()=>{this.sceneManager.setCameraPosition(i)});document.getElementById("toggle-rotate").addEventListener("click",()=>{this.sceneManager.controls.autoRotate=!this.sceneManager.controls.autoRotate})}initializePanelControls(){this.initializeSidebarToggle(),this.initializeInfoPanel()}initializeSidebarToggle(){setTimeout(()=>{if(this.collapseBtn=document.getElementById("collapse-btn"),this.expandBtn=document.getElementById("expand-btn"),this.controlsPanel=document.getElementById("controls"),!this.collapseBtn||!this.expandBtn||!this.controlsPanel){console.error("Sidebar toggle elements not found");return}this.sidebarCollapsed=!1,this.expandBtn.classList.add("hidden"),this.expandBtn.classList.remove("show");try{this.collapseBtn.addEventListener("click",this.handleCollapseClick.bind(this)),this.expandBtn.addEventListener("click",this.handleExpandClick.bind(this)),this.updateSidebarState()}catch(e){console.error("Failed to add event listeners:",e)}},100)}handleCollapseClick(e){e.preventDefault(),e.stopPropagation(),this.toggleSidebar(!0)}handleExpandClick(e){e.preventDefault(),e.stopPropagation(),this.toggleSidebar(!1)}toggleSidebar(e=null){e===null?this.sidebarCollapsed=!this.sidebarCollapsed:this.sidebarCollapsed=e,this.updateSidebarState()}updateSidebarState(){if(!this.controlsPanel||!this.expandBtn){console.error("Cannot update sidebar state - missing elements");return}this.sidebarCollapsed?(this.controlsPanel.classList.add("collapsed"),this.expandBtn.classList.add("show"),this.expandBtn.classList.remove("hidden"),this.expandBtn.setAttribute("aria-hidden","false")):(this.controlsPanel.classList.remove("collapsed"),this.expandBtn.classList.remove("show"),this.expandBtn.classList.add("hidden"),this.expandBtn.setAttribute("aria-hidden","true"))}initializeInfoPanel(){const e=document.getElementById("info-btn"),t=document.getElementById("info-panel"),i=document.getElementById("info-close-btn");if(!e||!t){console.warn("Info panel elements not found");return}e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),this.toggleInfoPanel()}),i&&i.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),this.closeInfoPanel()})}toggleInfoPanel(){const e=document.getElementById("info-btn"),t=document.getElementById("info-panel");e&&t&&(t.classList.contains("visible")?this.closeInfoPanel():this.openInfoPanel())}openInfoPanel(){const e=document.getElementById("info-btn"),t=document.getElementById("info-panel");e&&t&&(t.classList.add("visible"),e.classList.add("active"))}closeInfoPanel(){const e=document.getElementById("info-btn"),t=document.getElementById("info-panel");e&&t&&(t.classList.remove("visible"),e.classList.remove("active"))}setupEventListeners(){this.debouncedUpdateCurve=x(()=>this.sceneManager.updateCurve(this.params),d.DEBOUNCE_CURVE_UPDATE),this.debouncedUpdateGrid=x(()=>this.sceneManager.updateGrid(this.params),d.DEBOUNCE_GRID_UPDATE),this.throttledUpdateAudio=L(()=>this.audioSystem.updateParams(this.params),d.THROTTLE_AUDIO_UPDATE),window.addEventListener("resize",x(()=>this.sceneManager.handleResize(),d.DEBOUNCE_RESIZE)),window.addEventListener("beforeunload",()=>this.cleanup()),window.addEventListener("pagehide",()=>this.cleanup())}setupMathRendering(){try{const e=document.getElementById("equations");if(!e){console.warn("Equations div not found");return}const t=["x(t) = A e^{-\\lambda t} \\sin(a t' + \\delta_x)","y(t) = B e^{-\\lambda t} \\sin(b t' + \\delta_y)","z(t) = C e^{-\\lambda t} \\sin(c t' + \\delta_z)"];e.innerHTML="",t.forEach((i,n)=>{try{const s=document.createElement("div");s.className="equation-item",s.innerHTML=Q.renderToString(i,{displayMode:!0,throwOnError:!1,trust:!0}),e.appendChild(s)}catch(s){console.warn(`Failed to render equation ${n+1}:`,s);const o=document.createElement("div");o.className="equation-fallback",o.textContent=`$$${i}$$`,e.appendChild(o)}})}catch(e){console.error("Math rendering setup failed:",e);const t=document.getElementById("equations");t&&(t.innerHTML=`
                    <div class="equation-fallback">
                        <p>x(t) = A e^(-λt) sin(at' + δₓ)</p>
                        <p>y(t) = B e^(-λt) sin(bt' + δᵧ)</p>
                        <p>z(t) = C e^(-λt) sin(ct' + δᵧ)</p>
                    </div>
                `)}}updateGridBrightness(e){const t=this.sceneManager.getGridMaterial(e);this.sceneManager.gridGroup.traverse(i=>{i.material&&(i.material=t)})}updateGridThickness(e){this.throttledGridThicknessUpdate||(this.throttledGridThicknessUpdate=L(()=>{this.sceneManager.updateGrid(this.params)},16)),this.throttledGridThicknessUpdate()}async handleAudioToggle(e){try{e?(await this.audioSystem.init(),setTimeout(()=>{this.audioSystem.setVolume(.15),this.audioSystem.updateParams(this.params)},100)):this.audioSystem.setVolume(0)}catch(t){console.warn("Audio toggle failed:",t);const i=document.getElementById("toggle-audio");i&&(i.checked=!1,this.params.isAudioEnabled=!1)}}startAnimationLoop(){this.sceneManager.updateGrid(this.params),this.sceneManager.updateCurve(this.params),this.animate()}updatePhaseAnimation(){const e=this.clock.getElapsedTime(),t=e*.3%2,i=e*.4%2,n=e*.5%2;this.params.deltaX=t*Math.PI,this.params.deltaY=i*Math.PI,this.params.deltaZ=n*Math.PI,this.knobs.deltaX.setValue(t),this.knobs.deltaY.setValue(i),this.knobs.deltaZ.setValue(n),this.debouncedUpdateCurve()}cleanup(){try{this.cleanupKnobs(),this.cleanupSidebarEventListeners(),this.sceneManager.cleanup(),this.audioSystem.cleanup(),console.log("Application cleanup completed")}catch(e){console.warn("Cleanup error:",e)}}cleanupSidebarEventListeners(){this.collapseBtn&&this.collapseBtn.removeEventListener("click",this.handleCollapseClick),this.expandBtn&&this.expandBtn.removeEventListener("click",this.handleExpandClick)}}let I=!1,b=null;function B(){I||(I=!0,b&&typeof b.cleanup=="function"&&b.cleanup(),b=new le)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B();
//# sourceMappingURL=index-Cff_qJ60.js.map
